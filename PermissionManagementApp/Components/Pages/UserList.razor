@page "/users"
@inject UserService UserService
@inject RoleService RoleService

<h2>Benutzerübersicht</h2>

@if (users == null)
{
    <p>Lade Benutzer...</p>
}
else
{
    <div>
        @foreach (var user in users)
        {
            <div class="user-card" style="border:1px solid #ccc; padding:10px; margin-bottom:10px;">
                <strong>@user.Name</strong>

                @if (userPermissions.ContainsKey(user.Id))
                {
                    <ul>
                        @foreach (var permission in userPermissions[user.Id])
                        {
                            <li>@permission.Name</li>
                        }
                    </ul>
                }
                else
                {
                    <p style="color:gray;">Keine Berechtigungen</p>
                }
            </div>
        }
    </div>
}

@code {
    private List<User> users;
    private Dictionary<int, List<Permission>> userPermissions = new();

    protected override async Task OnInitializedAsync()
    {
        users = await UserService.GetAllUsersAsync();

        foreach (var user in users)
        {
            var permissions = await RoleService.GetUserPermissionsRecursiveAsync(user.Id);
            userPermissions[user.Id] = permissions;
        }
    }
}
